# Task 5.0: Update Therapist Registration Flow

## Relevant Files

- `frontend/src/components/dashboard/TherapistForm.tsx` - Therapist registration form (updated with full functionality)
- `frontend/src/components/dashboard/TherapistList.tsx` - Therapist management interface (created with full functionality)
- `frontend/src/components/auth/TherapistRegistration.tsx` - Therapist registration component (to be created)
- `frontend/src/hooks/useTherapist.ts` - Therapist API hook (created with mock API functions)
- `frontend/src/types/therapist.ts` - Therapist types and schemas (to be created)
- `frontend/src/store/therapist.ts` - Therapist state management (to be created)
- `frontend/src/components/auth/TherapistRegistration.test.tsx` - Unit tests (to be created)

### Notes

- Use mock API calls for development
- Unit tests should be placed alongside the code files they are testing
- Use `npx jest [optional/path/to/test/file]` to run tests

## Tasks

- [x] 5.1 Create therapist registration system (no invitation)
  - [x] Add therapist registration form in clinic dashboard
    - Create registration form with therapist details
    - Add email input validation
    - Add password setup fields
    - Add personal and professional information fields
    - Add specialization and experience fields
    - Add form validation and error handling
  - [x] Add therapist account creation functionality
    - Register therapist directly from dashboard
    - Save therapist data to system
    - Set initial therapist status (e.g., pending/active)
    - Send registration confirmation email
  - [x] Add therapist management interface
    - List registered therapists
    - View therapist details and status
    - Edit therapist information
    - Activate/deactivate therapist accounts

- [ ] 5.2 Create therapist registration component
  - [ ] Create separate therapist registration flow
    - Create therapist registration page
    - Add therapist profile form
    - Add password setup functionality
  - [ ] Add password setup functionality
    - Add password strength validation
    - Add password confirmation
    - Add password requirements display
    - Add password visibility toggle
  - [ ] Add profile completion form
    - Add personal information fields
    - Add professional credentials
    - Add specialization selection
    - Add experience details

- [ ] 5.3 Add therapist management
  - [ ] Add therapist account activation
    - Activate therapist account after registration
    - Send activation confirmation email
    - Update therapist status in system
    - Add activation tracking
  - [ ] Add therapist profile management
    - Allow therapists to update profiles
    - Add profile picture upload
    - Add credential management
    - Add specialization updates
  - [ ] Add therapist-client assignment
    - Assign clients to therapists
    - Manage therapist workload
    - Add assignment history
    - Add reassignment functionality
  - [ ] Add therapist performance tracking
    - Track session completion rates
    - Track client satisfaction scores
    - Track token usage per therapist
    - Add performance analytics

## Implementation Steps

### Step 1: Therapist Registration Form
```typescript
// In components/dashboard/TherapistForm.tsx
interface TherapistRegistrationForm {
  email: string;
  name: string;
  phone: string;
  specialization: string;
  licenseNumber: string;
  yearsExperience: number;
  education: string;
  certifications: string[];
  password: string;
  passwordConfirmation: string;
}

export const TherapistRegistrationForm: React.FC = () => {
  const { registerTherapist, loading } = useTherapist();
  
  const onSubmit = async (data: TherapistRegistrationForm) => {
    try {
      const result = await registerTherapist(data);
      if (result.success) {
        // Show success message
        toast.success('Therapist registered successfully');
      }
    } catch (error) {
      toast.error('Failed to register therapist');
    }
  };
  
  // Implementation details...
};
```

### Step 2: Therapist Registration Component
```typescript
// In components/auth/TherapistRegistration.tsx
export const TherapistRegistration: React.FC = () => {
  const { registerTherapist } = useTherapist();
  const [step, setStep] = useState<'profile' | 'password' | 'complete'>('profile');
  const [formData, setFormData] = useState<TherapistRegistrationForm | null>(null);
  
  const handleProfileSubmit = (profileData: any) => {
    setFormData({ ...profileData });
    setStep('password');
  };
  
  const handlePasswordSubmit = async (passwordData: any) => {
    try {
      const result = await registerTherapist({ ...formData, ...passwordData });
      if (result.success) {
        setStep('complete');
      }
    } catch (error) {
      // Handle error
    }
  };
  
  // Implementation details...
};
```

### Step 3: Therapist Management
```typescript
// In hooks/useTherapist.ts
export const useTherapist = () => {
  const registerTherapist = async (therapistData: any) => {
    // Mock API call
    await new Promise(resolve => setTimeout(resolve, 1000));
    return {
      success: true,
      therapist_id: 'th-' + Date.now(),
      account_activated: true
    };
  };
  
  const getTherapists = async () => {
    // Mock API call
    await new Promise(resolve => setTimeout(resolve, 500));
    return {
      success: true,
      therapists: [
        {
          id: 'th-1',
          name: 'Dr. Budi Santoso',
          email: 'budi@example.com',
          specialization: 'Anxiety Disorders',
          status: 'active'
        }
      ]
    };
  };
  
  const updateTherapist = async (id: string, data: any) => {
    // Mock API call
    await new Promise(resolve => setTimeout(resolve, 1000));
    return {
      success: true,
      therapist: { ...data, id }
    };
  };
  
  return { registerTherapist, getTherapists, updateTherapist };
};
```

## Testing Checklist

- [ ] Test therapist registration form validation
- [ ] Test therapist registration flow
- [ ] Test password setup functionality
- [ ] Test profile completion form
- [ ] Test therapist account activation
- [ ] Test therapist-client assignment
- [ ] Test performance tracking

## Mock Data

```typescript
// Mock therapist registration data
export const mockTherapistRegistration = {
  name: 'Dr. Budi Santoso',
  email: 'therapist@example.com',
  phone: '+62-812-3456-7890',
  specialization: 'Anxiety Disorders',
  licenseNumber: 'SIP-123456',
  yearsExperience: 5,
  education: 'S1 Psikologi, Universitas Indonesia',
  certifications: ['Certified Hypnotherapist', 'CBT Practitioner'],
  password: 'SecurePassword123!',
  passwordConfirmation: 'SecurePassword123!'
};

// Mock therapist performance data
export const mockTherapistPerformance = {
  therapist_id: 'th-1234567890',
  sessions_completed: 45,
  client_satisfaction: 4.8,
  tokens_used: 45,
  active_clients: 12,
  completion_rate: 0.95,
  average_session_duration: 60
};
```

## Component Structure

```
TherapistRegistration/
├── TherapistRegistration.tsx
├── TherapistRegistration.test.tsx
├── components/
│   ├── TherapistProfileForm.tsx
│   ├── PasswordSetup.tsx
│   └── RegistrationComplete.tsx
├── hooks/
│   └── useTherapistRegistration.ts
└── types/
    └── therapist.ts
```

## Security Considerations

- Password strength requirements
- Email verification for therapists
- Secure profile data handling
- Access control for therapist management
- Input validation and sanitization
- Secure authentication flow

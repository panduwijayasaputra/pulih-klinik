# Task 1.0: Update Registration Flow Structure

## Relevant Files

- `frontend/src/components/auth/RegisterFlow.tsx` - Main registration flow component (updated with new steps and navigation)
- `frontend/src/store/registration.ts` - Registration store (updated with verification data and methods)
- `frontend/src/types/registration.ts` - Types and schemas (updated with new step types and verification interface)
- `frontend/src/components/auth/RegisterFlow.test.tsx` - Unit tests (to be created)

### Notes

- Use mock data for API calls during development
- Unit tests should be placed alongside the code files they are testing
- Use `npx jest [optional/path/to/test/file]` to run tests

## Tasks

- [x] 1.1 Update registration step types and flow order
  - [x] Update `RegistrationStep` type in `types/registration.ts`
    - Add 'verification' and 'summary' steps
    - Update step order: clinic → verification → summary → payment → complete
  - [x] Update step titles and descriptions in `RegisterFlow.tsx`
    - Add titles: 'Verifikasi Email', 'Ringkasan Registrasi'
    - Add descriptions for new steps
  - [x] Update step navigation logic
    - Modify step progression to include new steps
    - Update step validation logic

- [x] 1.2 Update registration store for new flow
  - [x] Add verification step state management in `store/registration.ts`
    - Add `verificationData` to store state
    - Add `verificationCode` field
    - Add `emailSent` boolean flag
  - [x] Add email verification data storage
    - Store verification code attempts
    - Store email sending timestamp
    - Store verification status
  - [x] Update step navigation logic for new flow
    - Modify `nextStep()` and `prevStep()` functions
    - Add validation for step transitions
    - Add step completion checks
  - [x] Add verification code validation methods
    - Add `validateVerificationCode()` function
    - Add `resendVerificationEmail()` function
    - Add `clearVerificationData()` function

- [x] 1.3 Update progress tracking and UI
  - [x] Update progress bar to show 5 steps instead of 4
    - Modify progress calculation in `RegisterFlow.tsx`
    - Update step numbers display
    - Update percentage calculations
  - [x] Update step numbers and percentages
    - Change from "Langkah X dari 4" to "Langkah X dari 5"
    - Update progress percentage calculation
    - Update step indicator styling
  - [x] Update navigation buttons and back functionality
    - Modify back button visibility logic
    - Update back button behavior for new steps
    - Add step-specific navigation rules

## Implementation Steps

### Step 1: Update Types
```typescript
// In types/registration.ts
export type RegistrationStep = 'clinic' | 'verification' | 'summary' | 'payment' | 'complete';

export interface VerificationData {
  code: string;
  emailSent: boolean;
  attempts: number;
  lastSentAt?: Date;
  verified: boolean;
}
```

### Step 2: Update Store
```typescript
// In store/registration.ts
interface RegistrationStore {
  // ... existing properties
  verificationData: VerificationData;
  validateVerificationCode: (code: string) => boolean;
  resendVerificationEmail: () => Promise<void>;
}
```

### Step 3: Update Component
```typescript
// In RegisterFlow.tsx
const stepTitles = {
  clinic: 'Informasi Klinik',
  verification: 'Verifikasi Email',
  summary: 'Ringkasan Registrasi',
  payment: 'Pembayaran',
  complete: 'Selesai'
};
```

## Testing Checklist

- [ ] Test step navigation (forward and backward)
- [ ] Test step validation and completion
- [ ] Test progress bar accuracy
- [ ] Test navigation button visibility
- [ ] Test store state persistence
- [ ] Test verification data storage
- [ ] Test step transition validation

## Mock Data

```typescript
// Mock verification data for testing
export const mockVerificationData = {
  code: '123456',
  emailSent: true,
  attempts: 0,
  lastSentAt: new Date(),
  verified: false
};

// Mock API responses
export const mockSendVerificationEmail = async (email: string) => {
  await new Promise(resolve => setTimeout(resolve, 1000));
  return { success: true, message: 'Verification email sent' };
};

export const mockVerifyCode = async (code: string) => {
  await new Promise(resolve => setTimeout(resolve, 500));
  return { success: code === '123456', message: code === '123456' ? 'Code verified' : 'Invalid code' };
};
```
